



{% extends 'base.html' %}
{% block content %}
    {% if session['user_id'] == cal.user_id %}
        <h1>{{ cal.title }}</h1>
        <div id="calendar"></div>
    {% else %}
        <p>Please login to view calendar</p>
    {% endif %}

    <br><br><br>  
    <div id="event-form-modal">


      <form id="event-form" method="POST" disabled>
            <h3 id="title"> </h3>
            <table>
              <tr>
                <th> Workout layout </th>
                <th> Enter Workout results </th>
              </tr>
              
              <tr> 
                <td id="warmup"> Warmup:  </td> 
                <td> <input type="text" name="warmup-result" required> <td>
              </tr> 
              <tr>
                <td> <div id="body"> Body:</div>  <div id="repeats"> Repeats: </div> </td>
                <td id="rep_results"> </td> 
              </tr>
              <tr>
                <td id="cooldown"> Cooldown: </td> 
                <td><input type="text" name="cooldown-result" required></td>
              </tr>
                
            </table>
            <button type="submit">COMPLETE RUN</button> 
            
        </form>
    

      </div> 

    <script>
    
    

    document.addEventListener('DOMContentLoaded', function() {
      function updateResults(response) {
        console.log(response)
        console.log(response.layout.body)
        const eventFormModal = document.querySelector("#event-form-modal");
        const eventForm = document.querySelector("#event-form");
        // $( eventForm ).data('response', response);
        eventForm.setAttribute("action", `/enter_wo_results/${response.id}`);
        // alert(`${response['layout']}`);  
        $("#title").append(response.title);
        $("#warmup").append(response.layout.warmup);
        $("#body").append(response.layout.body)
        $("#repeats").append(response.layout.repeats)
        $("#cooldown").append(response.layout.cooldown)
        const repetition = Number(response.layout.repeats)

        for (let rep = 0; rep < repetition; rep++) {
          $("#rep_results").append(`<input type="text" name="body-result${rep}" required><br>`)
        } 
    }

      const workouts = {{ workouts | tojson }};
      // console.log('YAYYY', workouts[0]['wolayout'])
      
      var calendarEl = document.getElementById('calendar');

      var calendar = new FullCalendar.Calendar(calendarEl, {
        plugins: [ 'interaction', 'dayGrid', 'timeGrid' ],
        eventClick: function(info) {
          info.jsEvent.preventDefault();
          var eventObj = info.event;
          let data = {'id': eventObj.id}
          $.get('/workout_event', data, updateResults);

        },

        defaultView: 'dayGridMonth',
        defaultDate: workouts[0]['start'],
        header: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        timeZone: 'UTC',
        events: workouts 
      })
    calendar.render();
    })



    </script> 

  {% endblock %} 


  
